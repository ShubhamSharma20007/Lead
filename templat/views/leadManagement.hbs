<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-default"
  data-assets-path="/assets/" data-template="vertical-menu-template-free">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>Lead Managment</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/assets/img/favicon/favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="/assets/vendor/fonts/boxicons.css" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="/assets/vendor/css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="/assets/css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <link rel="stylesheet" href="/assets/vendor/libs/apex-charts/apex-charts.css" />

  <!-- Page CSS -->

  <!-- Helpers -->
  <script src="/assets/vendor/js/helpers.js"></script>
  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="/assets/js/config.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">

</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->

      {{>Sidebar}}
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->

        {{>navBar}}
        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->
          <div class="container-xxl flex-grow-1 container-p-y">
            <div class="row">
              <div class="col-lg-12">
                <div class="card bg-transparent box-shadow-none border-0 ">
                  <div class="drag-container"></div>
                  <div class="board-container">
                    <div class="d-flex slide-container" style="overflow-x: auto; width:100%; height:100%;">
                      <div class="board-column todo" id="container1" data-container-id="container1" ondrop="drop(event)"
                        ondragover="allowDrop(event)">
                        <div class="board-column-container ">
                          <div class="board-column-header d-flex align-items-center " style="gap: 5px;"
                            data-target-status="New Lead">New Lead({{
                            newLeads.length }})
                            {{#if isAdmin}}
                            <i class="ri-add-circle-line m-0 h5 text-white addFieldBtn " style="cursor: pointer;"></i>
                            {{else}}
                            {{/if}}
                          </div>

                          <div class="board-column-content-wrapper">
                            <div class="board-column-content">
                              {{#each newLeads}}
                              <div class="board-item" draggable="true" ondragstart="drag(event)" id="card1_{{this.Id}}"
                                data-lead-id="{{this.Id}}">
                                <div class="board-item-content">
                                  <div class="plan">
                                    <div class="inner">
                                      <span class="pricing">
                                        <span>
                                          <small><i class="ri-file-add-line" id="newLeadsIcon"></i></small>
                                        </span>
                                      </span>
                                      <!-- <p class="title">Professional</p> -->
                                      {{#each this.dataValues}}
                                      <p class="info" style="font-size: 13px;">{{@key}}:
                                        {{this}}</p>
                                      {{/each}}
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {{/each}}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="board-column working" id="container2" data-container-id="container2"
                        ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="board-column-container">
                          <div class="board-column-header" data-target-status="Contact Initiation">
                            Contact Initiation({{
                            contactInitiation.length }})</div>
                          <div class="board-column-content-wrapper">
                            <div class="board-column-content">
                              {{#each contactInitiation}}
                              <div class="board-item" draggable="true" ondragstart="drag(event)" id="card2_{{this.Id}}"
                                data-lead-id="{{this.Id}}">
                                <div class="board-item-content">
                                  <div class="plan">
                                    <div class="inner">
                                      <span class="pricing">
                                        <span>
                                          <small><i class="ri-file-add-line"></i></small>
                                        </span>
                                      </span>
                                      <!-- <p class="title">Professional</p> -->
                                      {{#each this.dataValues}}
                                      <p class="info" style="font-size: 13px;">{{@key}}:
                                        {{this}}</p>
                                      {{/each}}
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {{/each}}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="board-column todo" id="container3" ondrop="drop(event)" data-container-id="container3"
                        ondragover="allowDrop(event)">
                        <div class="board-column-container">
                          <div class="board-column-header" data-target-status="Schedule Follow Up">
                            Schedule Follow Up({{
                            scheduleFollowUp.length }})</div>
                          <div class="board-column-content-wrapper">
                            <div class="board-column-content">
                              {{#each scheduleFollowUp}}
                              <div class="board-item" draggable="true" ondragstart="drag(event)" id="card3_{{this.Id}}"
                                data-lead-id="{{this.Id}}">
                                <div class="board-item-content">
                                  <div class="plan">
                                    <div class="inner">
                                      <span class="pricing">
                                        <span>
                                          <small><i class="ri-file-add-line"></i></small>
                                        </span>
                                      </span>
                                      <!-- <p class="title">Professional</p> -->
                                      {{#each this.dataValues}}
                                      <p class="info" style="font-size: 13px">{{@key}}:
                                        {{this}}</p>
                                      {{/each}}
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {{/each}}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>

              </div>
            </div>
          </div>
          <!-- / Content -->

          <!-- Footer -->

          {{>footer}}
          <!-- / Footer -->

          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
  </div>


</body>

<script>
  document.addEventListener('click', function (event) {
    if (event.target.classList.contains('ri-file-add-line')) {
      var infoParagraphs = document.querySelectorAll('.board-item-content .info');

      infoParagraphs.forEach(function (paragraph) {
        var labelText = paragraph.textContent.split(':')[0].trim();
        var valueText = paragraph.textContent.split(':')[1].trim();

        var labelElement = document.createElement('label');
        labelElement.textContent = labelText;

        var inputElement = document.createElement('input');
        inputElement.name = labelText.replace(/\s/g, '_');
        inputElement.id = labelText.replace(/\s/g, '_').toLowerCase();
        inputElement.value = valueText;

        paragraph.parentNode.replaceChild(labelElement, paragraph);
        labelElement.parentNode.insertBefore(inputElement, labelElement.nextSibling);
      });

      var saveButton = document.createElement('button');
      saveButton.textContent = 'Save';
      saveButton.classList.add('save-button');

      var container = document.querySelector('.board-column-content');
      container.appendChild(saveButton);
    }
  });

  document.addEventListener('click', async function (event) {
    if (event.target.classList.contains('save-button')) {
      var inputFields = document.querySelectorAll('.board-item-content input');
      var leadId = event.target.closest('.board-item').getAttribute('data-lead-id');
      var updatedData = {};

      inputFields.forEach(function (input) {
        var label = input.previousSibling.textContent.split(':')[0].trim();
        updatedData[label] = input.value;
      });

      try {
        const response = await fetch('/update-dataLead', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            Id: leadId,
            ...updatedData
          })
        });

        if (response.ok) {
          inputFields.forEach(function (input) {
            var paragraph = document.createElement('p');
            paragraph.textContent = input.previousSibling.textContent + ': ' + input.value;
            paragraph.classList.add('info');
            input.parentNode.replaceChild(paragraph, input);
          });
          event.target.remove();
          alert('Lead details updated successfully');
        } else {
          alert('Failed to update lead details');
        }
      } catch (error) {
        console.error('Error updating lead details:', error);
        alert('Internal Server Error');
      }
    }
  });
</script>


<script src="scripts/leadmanagement.js"></script>
<script src="/assets/js/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

</html>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Livvic:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,900&display=swap');

  input {
    border-radius: 4px;
    margin: 3px 0px;
    border: none;
    width: 100%;
    padding: 4px 8px;
    font-size: 13px;
  }

  label {
    display: block;
  }

  .save-button {
    margin-left: 7%;
    border: none;
    color: #fff;
    background-color: #696cff;
    border-color: #696cff;
    box-shadow: 0 0.125rem 0.25rem 0 rgba(105, 108, 255, 0.4);
    padding: 7px 20px;
    border-radius: 4px;
  }

  .bg-transparent {
    box-shadow: none;
  }

  .drag-container {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1000;
  }

  .board {
    position: relative;
    display: flex;
    /* Add flex display to arrange columns horizontally */
    overflow-x: auto;
    /* Add horizontal scrolling */
    width: calc(350px * 4);
    /* Adjust the width based on the number of columns */
  }

  .board-column {
    width: 350px;
    /* Set fixed width for each column */

    /* Add some space between columns */
  }


  .board-container {
    overflow-x: auto;
    /* Enable horizontal scrolling */
  }

  .board {
    position: relative;
    display: flex;
    /* Add flex display to arrange columns horizontally */
  }

  .board-column {
    width: 350px;
    /* Set fixed width for each column */

  }

  .board-column.muuri-item-releasing {
    z-index: 2;
  }

  .board-column.muuri-item-dragging {
    z-index: 3;
    cursor: move;
  }

  .board-column-container {
    position: relative;
    width: 100%;
    height: 100%;
    box-shadow: none !important;

  }

  .board-column {
    width: 280px;
  }

  .board-column-content-wrapper,
  .board-column-header {
    width: 270px !important;
  }

  .board-column-header {
    position: relative;
    height: 50px;
    line-height: 50px;
    overflow: hidden;
    padding: 0 20px;
    text-align: justify;
    color: #121212e3;
    border-radius: 5px 5px 0 0;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    background: #f0f0f066;
    font-family: 'Livvic', sans-serif;
  }




  .board-column-content-wrapper {
    position: relative;
    padding: 8px;
    background: #f0f0f066;
    height: calc(100vh - 90px);
    overflow-y: auto;
    border-radius: 0 0 5px 5px;
  }

  .board-column-content {
    position: relative;
    min-height: 100%;

  }

  .board-item {
    position: relative;
    width: calc(100% - 16px);
    margin: 8px;

  }

  .board-item.muuri-item-releasing {
    z-index: 9998;
  }

  .board-item.muuri-item-dragging {
    z-index: 9999;
    cursor: move;
  }

  .board-item.muuri-item-hidden {
    z-index: 0;
  }

  .board-item-content {
    position: relative;
    border-radius: 4px;
    font-size: 17px;
    cursor: pointer;

  }

  @media (max-width: 600px) {
    .board-item-content {
      text-align: center;
    }

    .board-item-content span {
      display: none;
    }
  }

  dialog {
    width: 40%;
    min-height: 30%;
    position: absolute;
    border: 1px solid lightgray;
    border-radius: 10px;
    padding: 20px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
  }

  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .new-class {
    text-transform: capitalize;
  }

  #lableName {
    border: 1px solid rgb(185, 185, 185);
    height: 40px;
  }

  .form-control {
    height: 40px !important;
    border: 1px solid rgb(235, 233, 233);
  }

  p {
    text-transform: capitalize !important;
  }

  .board-item-content {
    min-height: 200px;
    max-height: 300px !important;
    overflow-y: scroll !important;
    font-family: "Overpass", sans-serif !important;
    background: #faebd7b5 !important;
    font-size: 0.999rem !important;
    border-radius: 8px !important;
    line-height: 1.5;
    background-image: url(https://node.scaleedge.in/assets/images/dashboard/circle.svg) !important;
    background-position: start;
    background-size: cover !important;
    background-repeat: no-repeat;
  }

  .board-item-content::-webkit-scrollbar {
    width: 0px
  }

  .slide-container::-webkit-scrollbar {

    height: 9px;
  }

  .slide-container::-webkit-scrollbar-thumb {
    background-color: #8888888f;
    border-radius: 10px;
  }

  .slide-container::-webkit-scrollbar-track {
    background-color: #f1f1f1;
    border-radius: 10px;
  }

  .plan {
    box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px !important;
    padding: 6px;
    background-color: #f0f0f066;
    color: #697e91;
    max-width: 300px;
  }

  .plan strong {
    font-weight: 600;
    color: #425275;
  }



  .plan .inner {
    align-items: center;
    padding: 6px 10px;
    border-radius: 12px;

  }

  .plan .pricing {
    position: absolute;
    top: 0;
    right: 0;
    border-radius: 99em 0 0 99em;
    display: flex;
    align-items: center;
    padding: 0.625em 0.75em;
    font-size: 1.25rem;
    font-weight: 600;
    color: #425475;
  }

  .plan .pricing small {
    color: #707a91;
    font-size: 0.75em;
    margin-left: 0.25em;
  }

  .plan .title {
    font-weight: 600;
    font-size: 1.25rem;
    color: #425675;
  }

  .plan .title+* {
    margin-top: 0.75rem;
  }

  .plan .info+* {
    margin-top: 1rem;
  }

  .plan .features {
    display: flex;
    flex-direction: column;
  }

  .plan .features li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .plan .features li+* {
    margin-top: 0.75rem;
  }

  .plan .features .icon {
    background-color: #1FCAC5;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
  }

  .plan .features .icon svg {
    width: 14px;
    height: 14px;
  }

  .plan .features+* {
    margin-top: 1.25rem;
  }

  .plan .action {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: end;
  }

  .plan .button {
    background-color: #6558d3;
    border-radius: 6px;
    color: #fff;
    font-weight: 500;
    font-size: 1.125rem;
    text-align: center;
    border: 0;
    outline: 0;
    width: 100%;
    padding: 0.625em 0.75em;
    text-decoration: none;
  }

  .plan .button:hover,
  .plan .button:focus {
    background-color: #4133B7;
  }
</style>